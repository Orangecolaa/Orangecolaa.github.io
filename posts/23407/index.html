<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Django开发投票应用 | Orangecola</title><meta name="keywords" content="Django"><meta name="author" content="Orange cola"><meta name="copyright" content="Orange cola"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="第一个Django应用本文以创建一个Web投票应用为例，使用Django开发Web应用，进一步了解Django的功能。本次应用使用Pycharm进行开发。 该应用（app）包括以下两个部分：  一个可以让公众用户进行投票和查看投票结果的站点 一个可以进行增、删、改、查的后台管理界面，也就是我们常说的admin站点  一、新建项目在Pycharm中新建一个Django项目（专业版Pycharm才支持"><meta property="og:type" content="article"><meta property="og:title" content="Django开发投票应用"><meta property="og:url" content="https://www.orangecola.cn/posts/23407/index.html"><meta property="og:site_name" content="Orangecola"><meta property="og:description" content="第一个Django应用本文以创建一个Web投票应用为例，使用Django开发Web应用，进一步了解Django的功能。本次应用使用Pycharm进行开发。 该应用（app）包括以下两个部分：  一个可以让公众用户进行投票和查看投票结果的站点 一个可以进行增、删、改、查的后台管理界面，也就是我们常说的admin站点  一、新建项目在Pycharm中新建一个Django项目（专业版Pycharm才支持"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Orangecolaa/PicX_Posts_Image@main/Blog_Image/Django02.1or73c29oyhs.png"><meta property="article:published_time" content="2021-10-16T11:20:00.000Z"><meta property="article:modified_time" content="2021-10-26T03:42:00.824Z"><meta property="article:author" content="Orange cola"><meta property="article:tag" content="Django"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Orangecolaa/PicX_Posts_Image@main/Blog_Image/Django02.1or73c29oyhs.png"><link rel="shortcut icon" href="/images/logo/DREAM36x36.png"><link rel="canonical" href="https://www.orangecola.cn/posts/23407/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="baidu-site-verification" content="code-e6rxIzMQUl"><link rel="manifest" href="/manifest.json"><meta name="msapplication-TileColor" content="#ffffff"><link rel="apple-touch-icon" sizes="180x180" href="/images/pwaicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/pwaicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/pwaicons/favicon-16x16.png"><link rel="mask-icon" href="/images/pwaicons/safari-pinned-tab.svg" color="#5bbad5"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"简"},noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:{chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#49b1f5",bgDark:"#121212",position:"bottom-left"},source:{jQuery:"https://cdn.jsdelivr.nejst/npm/jquery@latest/dist/jquery.min.js",justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js",css:"https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css"},fancybox:{js:"https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js",css:"https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"}},isPhotoFigcaption:!1,islazyload:!1,isanchor:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"Django开发投票应用",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2021-10-26 03:42:00"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const a=864e5*o,c={value:t,expiry:(new Date).getTime()+a};localStorage.setItem(e,JSON.stringify(c))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise((t,o)=>{const a=document.createElement("script");a.src=e,a.async=!0,a.onerror=o,a.onload=a.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};const t=saveToLocal.get("theme"),o=window.matchMedia("(prefers-color-scheme: dark)").matches,a=window.matchMedia("(prefers-color-scheme: light)").matches,c=window.matchMedia("(prefers-color-scheme: no-preference)").matches,n=!o&&!a&&!c;if(void 0===t){if(a)activateLightMode();else if(o)activateDarkMode();else if(c||n){const e=(new Date).getHours();e<=6||e>=18?activateDarkMode():activateLightMode()}window.matchMedia("(prefers-color-scheme: dark)").addListener((function(e){void 0===saveToLocal.get("theme")&&(e.matches?activateDarkMode():activateLightMode())}))}else"light"===t?activateLightMode():activateDarkMode();const i=saveToLocal.get("aside-status");void 0!==i&&("hide"===i?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));const r=saveToLocal.get("global-font-size");void 0!==r&&document.documentElement.style.setProperty("--global-font-size",r+"px")})(window)</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" media="print" onload='this.media="screen"'><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="Orangecola" type="application/atom+xml"></head><body><a href="javascript:void(0);" rel="external nofollow noreferrer" onclick="preloader.endLoading()" title="点击跳过动画"></a><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="wizard-scene"><div class="wizard-objects"><div class="wizard-square"></div><div class="wizard-circle"></div><div class="wizard-triangle"></div></div><div class="wizard"><div class="wizard-body"></div><div class="wizard-right-arm"><div class="wizard-right-hand"></div></div><div class="wizard-left-arm"><div class="wizard-left-hand"></div></div><div class="wizard-head"><div class="wizard-beard"></div><div class="wizard-face"><div class="wizard-adds"></div></div><div class="wizard-hat"><div class="wizard-hat-of-the-hat"></div><div class="wizard-four-point-star --first"></div><div class="wizard-four-point-star --second"></div><div class="wizard-four-point-star --third"></div></div></div></div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/images/logo/DREAM744x744.png" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">12</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-book"></i> <span>文章</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时间轴</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-list"></i> <span>生活</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i> <span>音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i> <span>电影</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-camera-retro"></i> <span>相册</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://cdn.jsdelivr.net/gh/Orangecolaa/PicX_Posts_Image@main/Blog_Image/Django02.1or73c29oyhs.png)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Orangecola</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>首页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-book"></i> <span>文章</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>时间轴</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-list"></i> <span>生活</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i> <span>音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i> <span>电影</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-camera-retro"></i> <span>相册</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Django开发投票应用</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-10-16T11:20:00.000Z" title="发表于 2021-10-16 11:20:00">2021-10-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-10-26T03:42:00.824Z" title="更新于 2021-10-26 03:42:00">2021-10-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Django/">Django</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">10.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>40分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="Django开发投票应用"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="第一个Django应用"><a href="#第一个Django应用" class="headerlink" title="第一个Django应用"></a>第一个Django应用</h1><p>本文以创建一个Web投票应用为例，使用Django开发Web应用，进一步了解Django的功能。本次应用使用Pycharm进行开发。</p><p>该应用（app）包括以下两个部分：</p><ul><li>一个可以让公众用户进行投票和查看投票结果的站点</li><li>一个可以进行增、删、改、查的后台管理界面，也就是我们常说的admin站点</li></ul><h2 id="一、新建项目"><a href="#一、新建项目" class="headerlink" title="一、新建项目"></a>一、新建项目</h2><p>在Pycharm中新建一个Django项目（专业版Pycharm才支持Django）</p><p>指定项目路径目录和python版本环境</p><p><img src="https://typora101.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211015091131961.png" alt="image-20211015091131961"></p><p>这将在指定项目目录下生成一个mysite目录，也就是你的这个Django项目的根目录。它包含了一系列自动生成的目录和文件，具备各自专有的用途。</p><p>注意：在给项目命名的时候必须避开Django和Python的保留关键字，比如“django”，“test”等，否则会引起冲突和莫名的错误。</p><h2 id="二、创建投票应用-app"><a href="#二、创建投票应用-app" class="headerlink" title="二、创建投票应用(app)"></a>二、创建投票应用(app)</h2><p>在 Django 中，每一个应用（app）都是一个 Python 包，并且遵循着相同的约定。Django 自带一个工具，可以帮你生成应用的基础目录结构。</p><p>app应用与project项目的区别：</p><ul><li>一个app实现某个具体功能，比如博客、公共档案数据库或者简单的投票系统；</li><li>一个project是配置文件和多个app的集合，这些app组合成整个站点；</li><li>一个project可以包含多个app；</li><li>一个app可以属于多个project！</li></ul><p>app的存放位置可以是任何地点，但是通常都将它们放在与<code>manage.py</code>脚本同级的目录下，这样方便导入文件。</p><p>在Pycharm中，没有可以创建app的图形化按钮，需要在下方的<code>Terminal</code>终端中输入命令（后面命令行都是在此终端输入）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py startapp polls</span><br></pre></td></tr></table></figure><p><img src="https://typora101.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211015091838979.png" alt="image-20211015091838979"></p><p>通过前面在Pycharm中创建工程的方式有个方便之处，点击Terminal后，会自动进入虚拟环境。</p><h2 id="三、编写第一个视图"><a href="#三、编写第一个视图" class="headerlink" title="三、编写第一个视图"></a>三、编写第一个视图</h2><p>开始编写第一个视图</p><p>在<code>polls/views.py</code>文件中，编写代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&quot;这里是orangecola的投票站点&quot;</span>)</span><br></pre></td></tr></table></figure><p>为了调用该视图，我们还需要编写urlconf，也就是路由配置。</p><p>在polls目录中新建一个文件或者将项目下的总<code>urls.py</code>复制过来，名字为<code>urls.py</code>（不要换成别的名字），在其中输入或修改代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;&#x27;</span>, views.index, name=<span class="string">&#x27;index&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;&lt;int:question_id&gt;/&#x27;</span>, views.detail, name=<span class="string">&#x27;detail&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;&lt;int:question_id&gt;/results/&#x27;</span>, views.results, name=<span class="string">&#x27;results&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;&lt;int:question_id&gt;/vote/&#x27;</span>, views.vote, name=<span class="string">&#x27;vote&#x27;</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>接下来，在项目的<strong>主urls.py文件</strong>中添加<code>urlpattern</code>条目，指向我们刚才建立的polls这个app独有的urls.py文件，这里需要导入include模块。打开<code>mysite/urls.py</code>文件，代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">&#x27;polls/&#x27;</span>, include(<span class="string">&#x27;polls.urls&#x27;</span>)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>include语法相当于多级路由，它把接收到的url地址去除与此项匹配的部分，将剩下的字符串传递给下一级路由urlconf进行判断。在路由的章节，有更加详细的用法指导。</p><p><strong>建议</strong>：除了admin路由外，尽量给每个app设计自己独立的二级路由。</p><p>启动服务器，在浏览器中访问地址<code>http://localhost:8000/polls/</code></p><p>一切正常的话，你将看到<code>这里是orangecola的投票站点</code></p><h2 id="四、settings和数据库配置"><a href="#四、settings和数据库配置" class="headerlink" title="四、settings和数据库配置"></a>四、settings和数据库配置</h2><p>在myweb/settings.py文件中，通过DATABASES项进行数据库设置</p><p>需要提前创建好mysite数据库</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;mysite&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;HOST&#x27;</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PORT&#x27;</span>: <span class="string">&#x27;3306&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意：Django使用MySQL数据库需要加载 MySQLdb模块，需要安装 mysqlclient，若已经安装请略过</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install  mysqlclient</span><br></pre></td></tr></table></figure><p>在修改settings文件时，请顺便将<code>TIME_ZONE</code>设置为国内所在的时区<code>Asia/Shanghai</code>，这样显示的就是我们北京时间。</p><p>以及将创建的app加入到settings的<code>INSTALLED_APPS</code>设置项中，它列出了所有的项目中被激活的Django应用（app），你必须将你自己创建的app注册在这里</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line"><span class="string">&#x27;django.contrib.admin&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;django.contrib.auth&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;django.contrib.contenttypes&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;django.contrib.messages&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;django.contrib.staticfiles&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;polls&#x27;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="五、创建模型"><a href="#五、创建模型" class="headerlink" title="五、创建模型"></a>五、创建模型</h2><p>进行定义模型，模型本质上就是数据库表的布局，再附加一些元数据。</p><p>Django通过自定义Python类的形式来定义具体的模型，每个模型的物理存在方式就是一个Python的类Class，每个模型代表数据库中的一张表，每个类的实例代表数据表中的一行数据，类中的每个变量代表数据表中的一列字段。</p><p>在这个应用中我们需要创建两个模型<code>Question</code>和<code>Choice</code>。</p><p>Question包含一个问题和一个发布日期。Choice包含两个字段：该选项的文本描述和该选项的投票数。每一条Choice都关联到一个Question。</p><p>编辑<code>polls/models.py</code>文件，编写代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> django.utils <span class="keyword">import</span> timezone</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Question</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="comment"># 问题</span></span><br><span class="line">    question_text = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    <span class="comment"># 发布日期</span></span><br><span class="line">    pub_date = models.DateTimeField(<span class="string">&#x27;date published&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.question_text</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 是否在当前发布的问卷</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">was_published_recently</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.pub_date &gt;= timezone.now() - datetime.timedelta(days=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Choice</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="comment"># 外键关联到Question</span></span><br><span class="line">    question = models.ForeignKey(Question, on_delete=models.CASCADE)</span><br><span class="line">    <span class="comment"># 文本描述</span></span><br><span class="line">    choice_text = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    <span class="comment"># 投票数</span></span><br><span class="line">    votes = models.IntegerField(default=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.choice_text</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>每一个类都是<code>django.db.models.Model</code>的子类。每一个字段都是<code>Field</code>类的一个实例，例如用于保存文本数据的CharField和用于保存时间类型的DateTimeField，它们告诉Django每一个字段保存的数据类型。</p><p>每一个Field实例的名字就是字段的名字（如： question_text 或者 pub_date ）。在你的Python代码中会使用这个值，你的数据库也会将这个值作为表的列名。</p><p>一些Field类必须提供某些特定的参数。例如CharField需要你指定<code>max_length</code>。这不仅是数据库结构的需要，同样也用于数据验证功能。</p><h3 id="启用模型"><a href="#启用模型" class="headerlink" title="启用模型"></a>启用模型</h3><p>在命令行输入：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations polls</span><br></pre></td></tr></table></figure><p>通过运行<code>makemigrations</code>命令，Django 会检测你对模型文件的修改，也就是告诉Django你对模型有改动，并且你想把这些改动保存为一个“<code>迁移(migration)</code>”。</p><p>接下来有一个叫做<code>migrate</code>的命令将对数据库执行真正的迁移动作。</p><p>进行数据迁移：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure><p>后续只需记住<strong>修改模型时的操作分三步</strong>：</p><blockquote><p>在models.py中修改模型；</p><p>运行<code>python manage.py makemigrations</code>为改动创建迁移记录文件；</p><p>运行<code>python manage.py migrate</code>，将操作迁移同步到数据库。</p></blockquote><h2 id="六、体验模型自带的API"><a href="#六、体验模型自带的API" class="headerlink" title="六、体验模型自带的API"></a>六、体验模型自带的API</h2><p>Django模型层自带ORM系统，会自动为每个模型创建数据库访问的API，直接拿来用就可以，非常简单、方便、易学。</p><p>进入Python交互环境，尝试使用Django提供的数据库访问API。要进入Python的shell，命令行输入：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py shell</span><br></pre></td></tr></table></figure><p>在shell中，我们可以做一些测试性、探索性、研究性的操作，但是要注意，这和在脚本中编写代码一样，也有可能会修改数据库中的实际数据。</p><p>当你进入shell后，尝试一下下面的API（这些代码必须执行，否则会影响后面的教程操作，我们不必管这些API的具体细节，先熟悉一下）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 导入我们写的模型类</span></span><br><span class="line">In：from polls.models import Question, Choice </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建一个新的question对象</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Django推荐使用timezone.now()代替python内置的datetime.datetime.now()</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这个timezone就来自于Django的依赖库pytz</span></span><br><span class="line">In：from django.utils import timezone</span><br><span class="line">In：q = Question(question_text=&quot;What&#x27;s new?&quot;, pub_date=timezone.now())</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 你必须显式的调用save()方法，才能将对象保存到数据库内</span></span><br><span class="line">In：q.save()</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 默认情况，你会自动获得一个自增的名为id的主键</span></span><br><span class="line">In：q.id</span><br><span class="line">Out：1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过python的属性调用方式，访问模型字段的值</span></span><br><span class="line">In：q.question_text</span><br><span class="line">Out：&quot;What&#x27;s new?&quot;</span><br><span class="line">In：q.pub_date</span><br><span class="line">Out：datetime.datetime(2012, 2, 26, 13, 0, 0, 775217, tzinfo=&lt;UTC&gt;)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 通过修改属性来修改字段的值，然后显式的调用save方法进行保存。</span></span><br><span class="line">In：q.question_text = &quot;What&#x27;s up?&quot;</span><br><span class="line">In：q.save()</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> objects.all() 用于查询数据库内的所有questions</span></span><br><span class="line">In：Question.objects.all()</span><br><span class="line">Out：&lt;QuerySet [&lt;Question: What&#x27;s up?&gt;]&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Django提供了大量的关键字参数查询API</span></span><br><span class="line">In：Question.objects.filter(id=1)</span><br><span class="line">Out：&lt;QuerySet [&lt;Question: What&#x27;s up?&gt;]&gt;</span><br><span class="line">In：Question.objects.filter(question_text__startswith=&#x27;What&#x27;)</span><br><span class="line">Out：&lt;QuerySet [&lt;Question: What&#x27;s up?&gt;]&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取今年发布的问卷</span></span><br><span class="line">In：from django.utils import timezone</span><br><span class="line">In：current_year = timezone.now().year</span><br><span class="line">In：Question.objects.get(pub_date__year=current_year)</span><br><span class="line">Out：&lt;Question: What&#x27;s up?&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询一个不存在的ID，会弹出异常</span></span><br><span class="line">In：Question.objects.get(id=2)</span><br><span class="line">Out：Traceback (most recent call last):</span><br><span class="line">	...</span><br><span class="line">	DoesNotExist: Question matching query does not exist.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Django为主键查询提供了一个缩写：pk。下面的语句和Question.objects.get(id=1)效果一样.</span></span><br><span class="line">In：Question.objects.get(pk=1)</span><br><span class="line">Out：&lt;Question: What&#x27;s up?&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 看看我们自定义的方法用起来怎么样</span></span><br><span class="line">In：q = Question.objects.get(pk=1)</span><br><span class="line">In：q.was_published_recently()</span><br><span class="line">Out：True</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示所有与q对象有关系的choice集合，目前是空的，还没有任何关联对象。</span></span><br><span class="line">In：q.choice_set.all()</span><br><span class="line">Out：&lt;QuerySet []&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建3个choices.</span></span><br><span class="line">In：q.choice_set.create(choice_text=&#x27;Not much&#x27;, votes=0)</span><br><span class="line">Out：&lt;Choice: Not much&gt;</span><br><span class="line">In：q.choice_set.create(choice_text=&#x27;The sky&#x27;, votes=0)</span><br><span class="line">Out：&lt;Choice: The sky&gt;</span><br><span class="line">In：c = q.choice_set.create(choice_text=&#x27;Just hacking again&#x27;, votes=0)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Choice对象可通过API访问和他们关联的Question对象</span></span><br><span class="line">In：c.question</span><br><span class="line">Out：&lt;Question: What&#x27;s up?&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 同样的，Question对象也可通过API访问关联的Choice对象</span></span><br><span class="line">In：q.choice_set.all()</span><br><span class="line">Out：&lt;QuerySet [&lt;Choice: Not much&gt;, &lt;Choice: The sky&gt;, &lt;Choice: Just hacking again&gt;]&gt;</span><br><span class="line">In：q.choice_set.count()</span><br><span class="line">Out：3</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> API会自动进行连表操作，通过双下划线分割关系对象。连表操作可以无限多级，一层一层的连接。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下面是查询所有的Choices，它所对应的Question的发布日期是今年。（重用了上面的current_year结果）</span></span><br><span class="line">In：Choice.objects.filter(question__pub_date__year=current_year)</span><br><span class="line">Out：&lt;QuerySet [&lt;Choice: Not much&gt;, &lt;Choice: The sky&gt;, &lt;Choice: Just hacking again&gt;]&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用delete方法删除对象</span></span><br><span class="line">In：c = q.choice_set.filter(choice_text__startswith=&#x27;Just hacking&#x27;)</span><br><span class="line">In：c.delete()</span><br></pre></td></tr></table></figure><p>模型是Django项目的核心，也是动态网站与数据库交互的核心，所以尽量多看理解。</p><h2 id="七、admin后台管理站点"><a href="#七、admin后台管理站点" class="headerlink" title="七、admin后台管理站点"></a>七、admin后台管理站点</h2><ol><li><p>创建管理员</p><p>创建一个可以登录admin站点的用户：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py createsuperuser</span><br></pre></td></tr></table></figure><p>按提示输入用户名，邮箱地址，密码确认即可。</p></li><li><p>启动服务器</p><p>在浏览器访问<code>http://127.0.0.1:8000/admin/</code> 你就能看到admin的登陆界面了</p></li><li><p>进入站点</p><p>利用刚才建立的admin账户，登陆admin，你将看到admin后台界面</p><p>当前只有两个可编辑的模型：Groups和Users。它们是<code>django.contrib.auth</code>模块提供的身份认证框架内的模型。</p></li><li><p>注册投票应用</p><p>应用必须先在admin中进行注册，告诉admin站点，请将polls的模型加入站点内，接受站点的管理</p><p>打开<code>polls/admin.py</code>文件，加入下面的内容：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question</span><br><span class="line"></span><br><span class="line">admin.site.register(Question)</span><br></pre></td></tr></table></figure><p>注册完成重启服务器就可以看到Question栏目了</p><p><img src="https://typora101.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211015104955227.png" alt="image-20211015104955227"></p></li></ol><h2 id="八、视图和模板"><a href="#八、视图和模板" class="headerlink" title="八、视图和模板"></a>八、视图和模板</h2><ol><li><p>视图概述：</p><p>Django 中的视图的概念是一类具有相同功能和模板的网页的集合。一个视图通常对应一个页面，提供特定的功能，使用特定的模板。</p><p>在我们的投票应用中，我们将建立下面的视图：</p><ul><li>问卷“index”页：显示最新的一些问卷</li><li>问卷“detail”页面：显示一个问卷的详细文本内容，没有调查结果但是有一个投票或调查表单。</li><li>问卷“results”页面：显示某个问卷的投票或调查结果。</li><li>投票动作页面：处理针对某个问卷的某个选项的投票动作。</li></ul><p>在Django中，网页和其它的一些内容都是通过视图来处理的。视图其实就是一个简单的Python函数（在基于类的视图中称为方法）。Django通过对比请求的URL地址来选择对应的视图，也就是路由。为了将 URL 和视图关联起来，Django 使用 <code>URLconfs</code>来配置路由。</p></li><li><p>编写视图文件</p><p>打开<code>polls/views.py</code>文件，编写代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, get_object_or_404</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse, HttpResponseRedirect</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> reverse</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question, Choice</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">request</span>):</span></span><br><span class="line">    latest_question_list = Question.objects.order_by(<span class="string">&#x27;-pub_date&#x27;</span>)  <span class="comment"># 按条件倒序排序</span></span><br><span class="line">    context = &#123;</span><br><span class="line">        <span class="string">&#x27;latest_question_list&#x27;</span>: latest_question_list</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;polls/index.html&#x27;</span>, context)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detail</span>(<span class="params">request, question_id</span>):</span></span><br><span class="line">    <span class="comment"># 1为模型，2关键字参数，如果对象不存在则弹出Http404错误</span></span><br><span class="line">    question = get_object_or_404(Question, pk=question_id)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;polls/detail.html&#x27;</span>, &#123;<span class="string">&#x27;question&#x27;</span>: question&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">results</span>(<span class="params">request, question_id</span>):</span></span><br><span class="line">    question = get_object_or_404(Question, pk=question_id)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&#x27;polls/results.html&#x27;</span>, &#123;<span class="string">&#x27;question&#x27;</span>: question&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">vote</span>(<span class="params">request, question_id</span>):</span></span><br><span class="line">    question = get_object_or_404(Question, pk=question_id)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        selected_choice = question.choice_set.get(pk=request.POST[<span class="string">&#x27;choice&#x27;</span>])</span><br><span class="line">    <span class="keyword">except</span>(KeyError, Choice.DoesNotExist):</span><br><span class="line">        context = &#123;</span><br><span class="line">            <span class="string">&#x27;question&#x27;</span>: question,</span><br><span class="line">            <span class="string">&#x27;error_message&#x27;</span>: <span class="string">&quot;You didn&#x27;t select a choice.&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;polls/detail.html&#x27;</span>, context)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        selected_choice.votes += <span class="number">1</span></span><br><span class="line">        selected_choice.save()</span><br><span class="line">        <span class="keyword">return</span> HttpResponseRedirect(reverse(<span class="string">&#x27;polls:results&#x27;</span>, args=(question.<span class="built_in">id</span>,)))</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>**render()**函数的第一个位置参数是请求对象（就是view函数的第一个参数），这个参数是固定写法，不需要变动。第二个位置参数是模板文件。还可以有一个可选的第三参数，一个字典，包含需要传递给模板的数据。最后render函数返回一个经过字典数据渲染过的模板封装而成的HttpResponse对象。</li><li>**get_object_or_404()**方法将一个Django模型作为第一个位置参数，后面可以跟上任意数量的关键字参数，如果对象不存在则弹出Http404错误。</li><li><code>request.POST</code>是一个类似字典的对象，允许你通过键名访问提交的数据。<code>request.POST[’choice’]</code>有可能触发一个KeyError异常。</li><li><code>HttpResponseRedirect</code>需要一个参数：重定向的URL。这里有一个建议，当你成功处理POST数据后，应当保持一个良好的习惯，始终返回一个<code>HttpResponseRedirect</code>。</li><li><code>reverse()</code>函数，它能帮助我们避免在视图函数中硬编码URL。它首先需要一个我们在URLconf中指定的name，然后是传递的数据。</li></ul><p>在<code>polls/urls.py</code>文件中加入下面的路由，将其映射到我们上面新增的视图</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定该应用的命名空间,此urls只应用于此应用</span></span><br><span class="line">app_name = <span class="string">&#x27;polls&#x27;</span></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;&#x27;</span>, views.index, name=<span class="string">&#x27;index&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;&lt;int:question_id&gt;/&#x27;</span>, views.detail, name=<span class="string">&#x27;detail&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;&lt;int:question_id&gt;/results/&#x27;</span>, views.results, name=<span class="string">&#x27;results&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;&lt;int:question_id&gt;/vote/&#x27;</span>, views.vote, name=<span class="string">&#x27;vote&#x27;</span>),</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><strong>URL names的命名空间</strong> 可以在polls/urls.py文件的开头部分，添加一个<code>app_name</code>的变量来指定该应用的命名空间，用来指定此urls.py只属于这个应用。</li></ul></li><li><p>使用模板</p><p>在<code>polls</code>目录下创建一个新的<code>templates</code>目录，Django会在它里面查找模板文件，在刚才创建的<code>templates</code>目录中，再创建一个新的子目录名叫<code>polls</code>，进入该子目录，创建一个新的HTML文件<code>index.html</code>。</p><p>你的模板文件应该是<code>polls/templates/polls/index.html</code>。</p></li></ol><p>编辑index.html文件：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>投票系统<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">&#123;% if latest_question_list %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        &#123;% for question in latest_question_list %&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;polls:detail&#x27; question.id %&#125;&quot;</span>&gt;</span>&#123;&#123; question.question_text &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>No polls are available.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>上面视图中index中的代码会加载<code>polls/index.html</code>文件，并传递给它一个参数。这个参数是一个字典，包含了模板变量名和Python对象之间的映射关系。</p><p>在浏览器中通过访问<code>/polls/</code>，你可以看到一个列表，包含<code>“What’s up”</code>的问卷，以及连接到其对应详细内容页面的链接点。</p><p>编辑detail.html文件：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>投票页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; question.question_text &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;% if error_message %&#125;<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>&#123;&#123; error_message &#125;&#125;<span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&#123;% url &#x27;polls:vote&#x27; question.id %&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    &#123;% csrf_token %&#125;</span><br><span class="line">    &#123;% for choice in question.choice_set.all %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;choice&quot;</span> <span class="attr">id</span>=<span class="string">&quot;choice&#123;&#123; forloop.counter &#125;&#125;&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; choice.id &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;choice&#123;&#123; forloop.counter &#125;&#125;&quot;</span>&gt;</span>&#123;&#123; choice.choice_text &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;投票&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>在 <code>&#123;% for %&#125;</code>循环中的方法调用——<code>question.choice_set.all</code>其实就是Python的代码<code>question.choice_set.all()</code>,它将返回一组可迭代的<code>Choice</code>对象，并用在<code>&#123;% for %&#125;</code>标签中。</p></li><li><p>为了接收用户的投票选择，我们需要在前端页面显示一个投票界面并创建一个form表单。action表示你要发送的目的url，method表示提交数据的方式，一般分post和get。</p></li><li><p><code>forloop.counter</code>是Django模板系统专门提供的一个变量，用来表示你当前循环的次数，一般用来给循环项目添加有序数标。</p></li><li><p>由于我们发送了一个POST请求，就必须考虑一个跨站请求伪造的安全问题，简称CSRF（具体含义请百度）。Django为你提供了一个简单的方法来避免这个困扰，那就是在form表单内添加一条<code>&#123;% csrf_token %&#125;</code>标签，标签名不可更改，固定格式，位置任意，只要是在form表单内。</p></li></ul><p>编辑results.html文件：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>投票结果<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; question.question_text &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">u1</span>&gt;</span></span><br><span class="line">    &#123;% for choice in question.choice_set.all %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; choice.choice_text &#125;&#125; -- &#123;&#123; choice.votes &#125;&#125; vote&#123;&#123; choice.votes|pluralize &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">u1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;polls:detail&#x27; question.id %&#125;&quot;</span>&gt;</span>Vote again?<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>投票结果<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; question.question_text &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">u1</span>&gt;</span></span><br><span class="line">    &#123;% for choice in question.choice_set.all %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; choice.choice_text &#125;&#125; -- &#123;&#123; choice.votes &#125;&#125; vote&#123;&#123; choice.votes|pluralize &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">u1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% url &#x27;polls:detail&#x27; question.id %&#125;&quot;</span>&gt;</span>Vote again?<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>现在你可以到浏览器中访问``<a target="_blank" rel="noopener external nofollow noreferrer" href="http://127.0.0.1:8000/polls/1/%60%E4%BA%86%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%BF%9B%E8%A1%8C%E6%8A%95%E7%A5%A8%E3%80%82%E6%8A%95%E7%A5%A8%E6%8F%90%E4%BA%A4%E5%AE%8C%E6%88%90%E4%BD%A0%E4%BC%9A%E7%9C%8B%E5%88%B0%E4%B8%80%E4%B8%AA%E7%BB%93%E6%9E%9C%E9%A1%B5%E9%9D%A2%EF%BC%8C%E6%AF%8F%E6%8A%95%E4%B8%80%E6%AC%A1%EF%BC%8C%E5%AE%83%E7%9A%84%E5%86%85%E5%AE%B9%E5%B0%B1%E6%9B%B4%E6%96%B0%E4%B8%80%E6%AC%A1%E3%80%82%E5%A6%82%E6%9E%9C%E4%BD%A0%E6%8F%90%E4%BA%A4%E7%9A%84%E6%97%B6%E5%80%99%E6%B2%A1%E6%9C%89%E9%80%89%E6%8B%A9%E9%A1%B9%E7%9B%AE%EF%BC%8C%E5%88%99%E4%BC%9A%E5%BE%97%E5%88%B0%E4%B8%80%E4%B8%AA%E9%94%99%E8%AF%AF%E6%8F%90%E7%A4%BA%E3%80%82">http://127.0.0.1:8000/polls/1/`了，可以进行投票。投票提交完成你会看到一个结果页面，每投一次，它的内容就更新一次。如果你提交的时候没有选择项目，则会得到一个错误提示。</a></p><h2 id="九、使用通用视图"><a href="#九、使用通用视图" class="headerlink" title="九、使用通用视图"></a>九、使用通用视图</h2><p>上面的detail、index和results视图的代码非常相似，有点冗余，他们都具有类似的业务逻辑，实现类似的功能：通过从URL传递过来的参数去数据库查询数据，加载一个模板，利用刚才的数据渲染模板，返回这个模板。Django提供了另一种快捷方式，名为“通用视图”。</p><p>将原来的代码改为使用通用视图的方式</p><ul><li>修改URLconf设置</li><li>删除一些旧的无用的视图</li><li>采用基于类视图的新视图</li></ul><p><strong>PS：为什么本教程的代码来回改动这么频繁？</strong></p><p>通常在写一个Django的app时，我们一开始就要决定使用通用视图还是不用，而不是等到代码写到一半了才重构你的代码成通用视图。但是为了让我们清晰的理解视图的内涵，“故意”走了一条比较曲折的路。</p><p>Django的视图类型可以分为函数视图和类视图，也就是FBV和CBV，两者各有优缺点，CBV不一定就高大上。大多数场景下，函数视图更简单易懂，代码量更少。但是在需要继承、封装某些视图的时候，CBV就能发挥优势。</p><p>通用视图其实就是Django内置的一些类视图，可以拿来直接使用。但非常简单，只适用于一些简单场景，如果业务逻辑比较复杂，依然需要改造类视图。</p><h3 id="1-修改URLconf"><a href="#1-修改URLconf" class="headerlink" title="1. 修改URLconf"></a>1. 修改URLconf</h3><p>打开<code>polls/urls.py</code>文件，将其修改：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定该应用的命名空间,此urls只应用于此应用</span></span><br><span class="line">app_name = <span class="string">&#x27;polls&#x27;</span></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;&#x27;</span>, views.IndexView.as_view(), name=<span class="string">&#x27;index&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;&lt;int:pk&gt;/&#x27;</span>, views.DetailView.as_view(), name=<span class="string">&#x27;detail&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;&lt;int:pk&gt;/results/&#x27;</span>, views.ResultsView.as_view(), name=<span class="string">&#x27;results&#x27;</span>),</span><br><span class="line">    path(<span class="string">&#x27;&lt;int:question_id&gt;/vote/&#x27;</span>, views.vote, name=<span class="string">&#x27;vote&#x27;</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="2-修改视图"><a href="#2-修改视图" class="headerlink" title="2. 修改视图"></a>2. 修改视图</h3><p>接下来修改视<code>polls/views.py</code>文件，将原来的index，detail和results视图删除，增加基于类视图的通用视图：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, get_object_or_404</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponseRedirect</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> reverse</span><br><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> generic</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question, Choice</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexView</span>(<span class="params">generic.ListView</span>):</span></span><br><span class="line">    template_name = <span class="string">&#x27;polls/index.html&#x27;</span></span><br><span class="line">    context_object_name = <span class="string">&#x27;latest_question_list&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;Return the last five published questions.&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> Question.objects.order_by(<span class="string">&#x27;-pub_date&#x27;</span>)[:<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DetailView</span>(<span class="params">generic.DetailView</span>):</span></span><br><span class="line">    model = Question</span><br><span class="line">    template_name = <span class="string">&#x27;polls/detail.html&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResultsView</span>(<span class="params">generic.DetailView</span>):</span></span><br><span class="line">    model = Question</span><br><span class="line">    template_name = <span class="string">&#x27;polls/results.html&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">vote</span>(<span class="params">request, question_id</span>):</span></span><br><span class="line">    question = get_object_or_404(Question, pk=question_id)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        selected_choice = question.choice_set.get(pk=request.POST[<span class="string">&#x27;choice&#x27;</span>])</span><br><span class="line">    <span class="keyword">except</span>(KeyError, Choice.DoesNotExist):</span><br><span class="line">        context = &#123;</span><br><span class="line">            <span class="string">&#x27;question&#x27;</span>: question,</span><br><span class="line">            <span class="string">&#x27;error_message&#x27;</span>: <span class="string">&quot;You didn&#x27;t select a choice.&quot;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;polls/detail.html&#x27;</span>, context)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        selected_choice.votes += <span class="number">1</span></span><br><span class="line">        selected_choice.save()</span><br><span class="line">        <span class="keyword">return</span> HttpResponseRedirect(reverse(<span class="string">&#x27;polls:results&#x27;</span>, args=(question.<span class="built_in">id</span>,)))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这个视图文件中使用了两种通用视图<code>ListView</code>和<code>DetailView</code>（它们是作为父类被继承的）。ListView：显示一个对象的列表，DetailView：显示特定类型对象的详细页面。</p><ul><li>每一种通用视图都需要知道它要作用在哪个模型上，这通过model属性提供。</li><li><code>DetailView</code>需要从url捕获到的称为”pk”的主键值，因此我们在url文件中将2和3条目的<code>&lt;question_id&gt;</code>修改成了<code>&lt;pk&gt;</code>。</li></ul><p><code>template_name</code>属性用来指定模板名的，用于代替自动生成的默认模板名，指定不同的模板显示不同的页面。</p><p>在前面部分的函数视图中我们给模板提供了一个包含<code>question</code>和<code>latest_question_list</code>的上下文变量。而对于DetailView，question变量会被自动提供，因为我们使用了Django的模型（Question），Django会智能的选择合适的上下文变量。然而，对于ListView，自动生成的上下文变量是<code>question_list</code>。为了覆盖它，使用了<code>context_object_name</code>属性，指定我们希望使用的变量为<code>latest_question_list</code>而不是<code>question_list</code>。</p><p>类视图是Django比较高级的一种用法，不太好理解，后面慢慢深入理解就好了。</p><p>现在可以重新运行开发服务器，然后试试基于类视图的应用程序了，效果和前面的函数视图是一样的。</p><h2 id="十、测试"><a href="#十、测试" class="headerlink" title="十、测试"></a>十、测试</h2><h3 id="1-自动化测试"><a href="#1-自动化测试" class="headerlink" title="1. 自动化测试"></a>1. 自动化测试</h3><p>测试是一种例行的、不可缺失的工作，用于检查你的程序是否符合预期。</p><p>自动化测试则是系统地较为完整地对程序进行测试，效率高，准确性高，并且大部分共同的测试工作会由系统来帮你完成。一旦你创建了一组自动化测试程序，当你修改了你的应用，你就可以用这组测试程序来检查你的代码是否仍然同预期的那样运行，而无需执行耗时的手动测试。</p><p><strong>为什么需要测试？</strong></p><ul><li><strong>测试可以节省你的时间</strong></li><li><strong>测试不仅仅可以发现问题，还能防止问题</strong></li><li><strong>测试使你的代码更受欢迎</strong></li><li><strong>测试有助于团队合作</strong></li></ul><h3 id="2-编写测试程序"><a href="#2-编写测试程序" class="headerlink" title="2. 编写测试程序"></a>2. 编写测试程序</h3><p>Django是一个全面、完善、严谨的Web框架，当然不会缺少测试功能。</p><p>每个app在创建的时候，都会自动创建一个<code>tests.py</code>文件，就像<code>views.py</code>等文件一样。通常，我们会把测试代码放在应用的<code>tests.py</code>文件中，测试系统将自动地从任何名字以test开头的文件中查找测试程序。</p><p>在投票应用的<code>polls/tests.py</code>文件中写入：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> django.utils <span class="keyword">import</span> timezone</span><br><span class="line"><span class="keyword">from</span> django.test <span class="keyword">import</span> TestCase</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QuestionMethodTests</span>(<span class="params">TestCase</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_was_published_recently_with_future_question</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        在将来发布的问卷应该返回False</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        time = timezone.now() + datetime.timedelta(days=<span class="number">30</span>)</span><br><span class="line">        future_question = Question(pub_date=time)</span><br><span class="line">        self.assertIn(future_question.was_published_recently(), <span class="literal">False</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我们在这里创建了一个<code>django.test.TestCase</code>的子类，它具有一个方法，该方法创建一个<code>pub_date</code>在未来的Question实例。最后我们检查<code>was_published_recently()</code>的输出，它应该是 False。</p><h3 id="3-运行测试程序"><a href="#3-运行测试程序" class="headerlink" title="3. 运行测试程序"></a>3. 运行测试程序</h3><p>在命令行输入：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py test polls</span><br></pre></td></tr></table></figure><p>运行结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Creating test database for alias &#39;default&#39;...</span><br><span class="line">System check identified no issues (0 silenced).</span><br><span class="line">F</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">FAIL: test_was_published_recently_with_future_question (polls.tests.QuestionMethodTe</span><br><span class="line">sts)</span><br><span class="line">在将来发布的问卷应该返回False</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;E:\PycharmProjects\Django\mysite\polls\tests.py&quot;, line 14, in test_was_publi</span><br><span class="line">shed_recently_with_future_question</span><br><span class="line">    self.assertIs(future_question.was_published_recently(), False)</span><br><span class="line">AssertionError: True is not False</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.003s</span><br><span class="line"></span><br><span class="line">FAILED (failures&#x3D;1)</span><br><span class="line">Destroying test database for alias &#39;default&#39;...</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><code>python manage.py test polls</code>命令会查找投票应用中所有的测试程序</li><li>发现一个<code>django.test.TestCase</code>的子类</li><li>为测试创建一个专用的数据库</li><li>查找名字以<code>test</code>开头的测试方法</li><li>在<code>test_was_published_recently_with_future_question</code>方法中，创建一个Question实例，该实例的pub_data字段的值是30天后的未来日期。</li><li>然后利用<code>assertIs()</code>方法，它发现<code>was_published_recently()</code>返回了True，而不是我们希望的False。</li></ul><p>测试程序会通知我们哪个测试失败了，错误出现在哪一行。</p><h3 id="4-修复bug"><a href="#4-修复bug" class="headerlink" title="4. 修复bug"></a>4. 修复bug</h3><p>现在知道bug出现在什么位置，就可以着手去修复了，修改<code>polls/models.py</code>代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">was_published_recently</span>(<span class="params">self</span>):</span></span><br><span class="line">	now = timezone.now()</span><br><span class="line">	<span class="keyword">return</span> now - datetime.timedelta(days=<span class="number">1</span>) &lt;= self.pub_date &lt;= now</span><br></pre></td></tr></table></figure><p>重新运行测试命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Creating test database for alias &#39;default&#39;...</span><br><span class="line">System check identified no issues (0 silenced).</span><br><span class="line">.</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.002s</span><br><span class="line"></span><br><span class="line">OK</span><br><span class="line">Destroying test database for alias &#39;default&#39;...</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>bug已经被修复，程序可以正常运行。</p><h3 id="5-更加全面的测试"><a href="#5-更加全面的测试" class="headerlink" title="5. 更加全面的测试"></a>5. 更加全面的测试</h3><p>事实上，前面的测试用例还不够完整，为了使<code>was_published_recently()</code>方法更加可靠，我们在上面的测试类中再额外添加两个其它的方法，来更加全面地进行测试。</p><p>修改<code>polls/tests.py</code>增加代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_was_published_recently_with_old_question</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    只要超过1天的问卷，就返回False</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    time = timezone.now() - datetime.timedelta(days=<span class="number">1</span>, seconds=<span class="number">1</span>)</span><br><span class="line">    old_question = Question(pub_date=time)</span><br><span class="line">    self.assertIs(old_question.was_published_recently(), <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_was_published_recently_with_recent_question</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    最近一天内的问卷，返回True</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    time = timezone.now() - datetime.timedelta(hours=<span class="number">23</span>, minutes=<span class="number">59</span>, seconds=<span class="number">59</span>)</span><br><span class="line">    recent_question = Question(pub_date=time)</span><br><span class="line">    self.assertIs(recent_question.was_published_recently(), <span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>现在我们有三个测试来保证无论发布时间是在过去、现在还是未来<code>Question.was_published_recently()</code>都将返回正确的结果。</p><h2 id="十一、静态文件"><a href="#十一、静态文件" class="headerlink" title="十一、静态文件"></a>十一、静态文件</h2><p>Web应用除了由服务器生成的HTML文件外，一般需要提供一些其它的必要文件，比如图片文件、JavaScript脚本和CSS样式表等等，用来为用户呈现出一个完整的网页。在Django中，我们将这些文件统称为“静态文件”，因为这些文件的内容基本是固定不变的，不需要动态生成，只需要放在指定位置模板中引用即可。</p><h3 id="1-使用静态文件"><a href="#1-使用静态文件" class="headerlink" title="1. 使用静态文件"></a>1. 使用静态文件</h3><p>首先在你的polls目录中创建一个<code>static</code>目录。Django将在那里查找静态文件，这与Django在polls/templates/中寻找对应的模板文件的方式是一致的。</p><p>在刚才的<code>static</code>目录中新建一个<code>polls</code>子目录，再在该子目录中创建一个css目录，在css目录中创建一个<code>style.css</code>文件。这个css样式文件对应的url为<code>polls/static/polls/style.css</code>。你可以通过书写<code>polls/style.css</code>在Django中访问这个静态文件，与你如何访问模板的路径类似。</p><blockquote><p>建议：1.在static/目录下创建与应用同名目录；2.在static/polls/目录下创建出css、js、images等各类区分开的静态文件目录，结构更规整。</p></blockquote><p>将下面的代码写入样式文件<code>polls/static/polls/css/style.css</code>：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">li</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下来在模板文件<code>polls/templates/polls/index.html</code>的头部加入下面的代码：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% load static %&#125;	# 放在页面第一行</span><br><span class="line"></span><br><span class="line"># 放在head标签中</span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% static &#x27;polls/css/style.css&#x27; %&#125;&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span>	</span><br></pre></td></tr></table></figure><p><code>&#123;% static %&#125;</code>模板标签会生成静态文件的绝对URL路径。</p><p>重启服务器查看页面，发现页面上的链接字体应用了你写的css样式了。</p><h3 id="2-添加背景图片"><a href="#2-添加背景图片" class="headerlink" title="2. 添加背景图片"></a>2. 添加背景图片</h3><p>按照上面一样，我们在<code>polls/static/polls/</code>目录下创建一个用于存放图片的<code>images</code>子目录，在这个子目录里放入<code>background.jpg</code>文件。</p><p>在css样式文件<code>polls/static/polls/css/style.css</code>中添加下面的代码：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: white <span class="built_in">url</span>(<span class="string">&quot;../images/background.jpg&quot;</span>) no-repeat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>重新加载<code>http://localhost:8000/polls/</code>(CTRL+F5)，你在页面会看到载入的背景图片。</p><p><code>&#123;% static %&#125;</code>模板标签不能用在静态文件，比如样式表中，因为他们不是由Django生成的。 你应该使用相对路径来相互链接静态文件，因为这样你可以改变<code>STATIC_URL</code>（ static模板标签用它来生成URLs）而不用同时修改一大堆静态文件中路径相关的部分。</p><h3 id="3-直接访问静态文件"><a href="#3-直接访问静态文件" class="headerlink" title="3. 直接访问静态文件"></a>3. 直接访问静态文件</h3><p>实际上不管是在Django开发服务器上，还是在<code>nginx+uwsgi+django</code>部署的服务器上，都可以直接通过url访问静态文件，不需要在Django中专门为每个静态文件编写url路由和视图。</p><h2 id="十二、自定义Admin"><a href="#十二、自定义Admin" class="headerlink" title="十二、自定义Admin"></a>十二、自定义Admin</h2><h3 id="1-自定义后台表单"><a href="#1-自定义后台表单" class="headerlink" title="1. 自定义后台表单"></a>1. 自定义后台表单</h3><p>在前面的学习过程中，通过<code>admin.site.register(Question)</code>语句，我们在admin站点中注册了Question模型。Django会自动生成一个该模型的默认表单页面。如果你想自定义该页面的外观和工作方式，可以在注册对象的时候告诉Django你的自定义选项。</p><p>下面是一个修改admin表单默认排序方式的例子。修改<code>polls/admin.py</code>的代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Register your models here.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QuestionAdmin</span>(<span class="params">admin.ModelAdmin</span>):</span></span><br><span class="line">    fields = [<span class="string">&#x27;pub_date&#x27;</span>, <span class="string">&#x27;question_text&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将app模型加入admin站点管理</span></span><br><span class="line">admin.site.register(Question, QuestionAdmin)</span><br></pre></td></tr></table></figure><p>只需要创建一个继承<code>admin.ModelAdmin</code>的模型管理类，在其中进行一些自定义操作，然后将它作为第二个参数传递给<code>admin.site.register()</code>，第一个参数则是Question模型本身。</p><p>上面的修改让<code>Date Publication</code>字段显示在<code>Question</code>字段前面了（默认是在后面）</p><p>如果有很多的字段，选择一种直观的符合我们人类习惯的排序方式则非常有用。但当表单含有大量字段的时候，你更多的是想将表单划分为一些字段的集合。</p><p>再次修改<code>polls/admin.py</code>:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Register your models here.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QuestionAdmin</span>(<span class="params">admin.ModelAdmin</span>):</span></span><br><span class="line">    fieldsets = [</span><br><span class="line">        (<span class="literal">None</span>,               &#123;<span class="string">&#x27;fields&#x27;</span>: [<span class="string">&#x27;question_text&#x27;</span>]&#125;),</span><br><span class="line">        (<span class="string">&#x27;Date information&#x27;</span>, &#123;<span class="string">&#x27;fields&#x27;</span>: [<span class="string">&#x27;pub_date&#x27;</span>]&#125;),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将app模型加入admin站点管理</span></span><br><span class="line">admin.site.register(Question, QuestionAdmin)</span><br></pre></td></tr></table></figure><p>字段集合<code>fieldsets</code>中每一个元组的第一个元素是该字段集合的标题。</p><p>如下图：</p><p><img src="C:\Users\Aiy52\AppData\Roaming\Typora\typora-user-images\image-20211015192358679.png" alt="image-20211015192358679"></p><h3 id="2-添加关联对象"><a href="#2-添加关联对象" class="headerlink" title="2. 添加关联对象"></a>2. 添加关联对象</h3><p>虽然我们已经有了Question的管理页面，但是一个Question有多个Choices，如果想显示Choices的内容怎么办？有两个办法可以解决这个问题。</p><p>第一个是像Question一样将Choice注册到admin站点，这很容易，修改<code>polls/admin.py</code>，增加下面的内容：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Choice, Question</span><br><span class="line"></span><br><span class="line">admin.site.register(Choice)</span><br></pre></td></tr></table></figure><p>重启服务器，再次访问admin页面，就可以看到Choice条目了。</p><p>点击它右边的增加按钮，进入“Add Choice”表单页面，如下图：</p><p><img src="https://typora101.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211015193422116.png" alt="image-20211015193422116"></p><p>在这个表单中，Question字段是一个select选择框，包含了当前数据库中所有的Question实例。<strong>Django在admin站点中，自动地将所有的外键关系展示为一个select框。</strong>在我们的例子中，目前只有一个question对象存在。</p><p>请注意图中的绿色加号，它连接到Question模型。每一个包含外键关系的对象都会有这个绿色加号。点击它，会弹出一个新增Question的表单，类似Question自己的添加表单。填入相关信息点击保存后，Django自动将该Question保存在数据库，并作为当前Choice的关联外键对象。白话讲就是，新建一个Question并作为当前Choice的外键。</p><p>第二种方法在创建Question对象的时候就可以直接添加一些Choice，删除<code>polls/admin.py</code>中Choice模型对<code>register()</code>方法的调用。然后，编辑Question的内容，最后整个文件的代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question, Choice</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Register your models here.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChoiceInline</span>(<span class="params">admin.StackedInline</span>):</span></span><br><span class="line">    model = Choice</span><br><span class="line">    extra = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QuestionAdmin</span>(<span class="params">admin.ModelAdmin</span>):</span></span><br><span class="line">    fieldsets = [</span><br><span class="line">        (<span class="literal">None</span>,               &#123;<span class="string">&#x27;fields&#x27;</span>: [<span class="string">&#x27;question_text&#x27;</span>]&#125;),</span><br><span class="line">        (<span class="string">&#x27;Date information&#x27;</span>, &#123;<span class="string">&#x27;fields&#x27;</span>: [<span class="string">&#x27;pub_date&#x27;</span>]&#125;),</span><br><span class="line">    ]</span><br><span class="line">    inlines = [ChoiceInline]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将app模型加入admin站点管理</span></span><br><span class="line">admin.site.register(Question, QuestionAdmin)</span><br></pre></td></tr></table></figure><p>上面的代码相当于告诉Django，Choice对象将在Question管理页面进行编辑，默认情况，请提供3个Choice对象的编辑区域。</p><p>重启服务器，进入“Add question”页面，应该看到如下图所示：</p><p><img src="https://typora101.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211015194854635.png" alt="image-20211015194854635"></p><p>在3个插槽的最后，还有一个<code>添加另一个 Choice</code>链接。点击它，又可以获得一个新的插槽。如果你想删除插槽，点击它最右边的灰色X图标即可。</p><p>这里还有点小问题。上面页面中插槽纵队排列的方式需要占据大块的页面空间，查看起来很不方便。为此，Django提供了一种扁平化的显示方式，你仅仅只需要修改一下<code>ChoiceInline</code>继承的类为<code>admin.TabularInline</code>替代先前的<code>StackedInline</code>类（其实，从类名上你就能看出两种父类的区别）。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChoiceInline</span>(<span class="params">admin.TabularInline</span>):</span></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure><p>重新刷新页面就可以看到如下图的排列方式：</p><p><img src="https://typora101.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211015195515894.png" alt="image-20211015195515894"></p><p>注意“删除”列，它可以删除那些已有的Choice和新建的Choice。</p><h3 id="3-定制实例的列表页面"><a href="#3-定制实例的列表页面" class="headerlink" title="3. 定制实例的列表页面"></a>3. 定制实例的列表页面</h3><p>Question的添加和修改页面我们已经自定义得差不多了，下面让我们来装饰一下“实例列表”(change list)页面，该页面显示了当前系统中所有的questions实例。</p><p>该页面默认看起来是这样的：</p><p><img src="https://typora101.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211015195916690.png" alt="image-20211015195916690"></p><p>通常，Django只显示<code>__str()__</code>方法指定的内容。但是很多时候，我们可能要同时显示一些别的内容。要实现这一目的，可以使用<code>list_display</code>属性，它是一个由字段组成的元组，其中的每一个字段都会按顺序显示在页面上，在<code>polls/admin.py</code>代码中添加：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QuestionAdmin</span>(<span class="params">admin.ModelAdmin</span>):</span></span><br><span class="line">	<span class="comment"># ...上面默认...</span></span><br><span class="line">	list_display = (<span class="string">&#x27;question_text&#x27;</span>, <span class="string">&#x27;pub_date&#x27;</span>, <span class="string">&#x27;was_published_recently&#x27;</span>)</span><br></pre></td></tr></table></figure><p>我们把<code>was_published_recently()</code>方法的结果也显示出来。如下图：</p><p><img src="https://typora101.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211015200313966.png" alt="image-20211015200313966"></p><p>你可以点击每一列的标题，来根据这列的内容进行排序。但是<code>was_published_recently</code>这一列除外，不支持这种根据函数输出结果进行排序的方式。同时请注意，<code>was_published_recently</code>这一列的列标题默认是方法的名字，内容则是输出的字符串表示形式。</p><p>可以通过给方法提供一些属性来改进输出的样式，如下面所示。注意<strong>这次修改的是<code>polls/models.py</code>文件</strong>，不要搞错了！主要是增加了最后面三行内容：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Question</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">was_published_recently</span>(<span class="params">self</span>):</span></span><br><span class="line">        now = timezone.now()</span><br><span class="line">        <span class="keyword">return</span> now - datetime.timedelta(days=<span class="number">1</span>) &lt;= self.pub_date &lt;= now</span><br><span class="line">    </span><br><span class="line">    was_published_recently.admin_order_field = <span class="string">&#x27;pub_date&#x27;</span></span><br><span class="line">    was_published_recently.boolean = <span class="literal">True</span></span><br><span class="line">    was_published_recently.short_description = <span class="string">&#x27;Published recently?&#x27;</span></span><br></pre></td></tr></table></figure><p>重启服务器刷新页面查看效果：</p><p><img src="https://typora101.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211016093810840.png" alt="image-20211016093810840"></p><p>我们还可以使用<code>list_filter</code>属性，<strong>对显示结果进行过滤</strong>!</p><p>在<code>polls/admin.py</code>的QuestionAdmin中添加下面的代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list_filter = [<span class="string">&#x27;pub_date&#x27;</span>]</span><br></pre></td></tr></table></figure><p>再次刷新change list页面，你会看到在页面右边多出了一个基于<code>pub_date</code>的过滤面板，如下图所示：</p><p><img src="https://typora101.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211016094011066.png" alt="image-20211016094011066"></p><p>根据你选择的过滤条件的不同，Django会在面板中添加不同的过滤选项。由于<code>pub_date</code>是一个<code>DateTimeField</code>，因此Django自动添加了这些日期选项。</p><p>还可以再添加一些搜索功能，同样在QuestionAdmin中添加下面的代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">search_fields = [<span class="string">&#x27;question_text&#x27;</span>]</span><br></pre></td></tr></table></figure><p>刷新页面查看效果，增加了搜索框：</p><p><img src="https://typora101.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211016094258278.png" alt="image-20211016094258278"></p><p>当输入搜索关键字后，Django会在<code>question_text</code>字段内进行搜索。只要你愿意，你可以使用任意多个搜索字段，Django在后台使用的都是SQL查询语句的LIKE语法，但是有限制的搜索字段有助于后台的数据库查询效率。</p><p>这个页面还自动提供分页功能，默认每页显示100条，只是我们的实例只有一个，所以不显示分页链接。</p><h3 id="4-定制Admin整体界面"><a href="#4-定制Admin整体界面" class="headerlink" title="4. 定制Admin整体界面"></a>4. 定制Admin整体界面</h3><p>在每一个项目的admin页面顶端都显示<code>Django管理</code>是很单调的，它仅仅是个占位文本。利用Django的模板系统，我们可以快速修改它</p><p>在<code>manage.py</code>文件同级下有一个<code>templates</code>目录，如果没有则自行创建。然后，打开设置文件<code>mysite/settings.py</code>，在TEMPLATES条目中有一个DIRS选项，同理没有的话自行添加代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&#x27;BACKEND&#x27;</span>: <span class="string">&#x27;django.template.backends.django.DjangoTemplates&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DIRS&#x27;</span>: [BASE_DIR / <span class="string">&#x27;templates&#x27;</span>]	<span class="comment"># 添加此行</span></span><br><span class="line">        ,</span><br><span class="line">        <span class="string">&#x27;APP_DIRS&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&#x27;OPTIONS&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;context_processors&#x27;</span>: [</span><br><span class="line">                <span class="string">&#x27;django.template.context_processors.debug&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.template.context_processors.request&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.auth.context_processors.auth&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;django.contrib.messages.context_processors.messages&#x27;</span>,</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>DIRS是一个文件系统目录的列表，是模板的搜索路径。当加载Django模板时，会在DIRS中进行查找。这里面的目录往往都是全局性的，区别于app自己内部的templates目录。</p><p>在templates目录中再创建一个admin目录，将<code>admin/base_site.html</code>模板文件拷贝到该目录内。这个HTML文件来自Django源码，它位于<code>django/contrib/admin/templates</code>目录内。（我的本机上时D:\python37\Lib\site-packages\django\contrib\admin\templates\admin）可供参考。事实上，如果你用的是Pycharm建立的虚拟环境，那么直接去<code>venv</code>目录中寻找即可。</p><p><strong>提示：</strong>如果你无法找到Django源代码文件的存放位置，可以使用下面的命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;import django; print(django.__path__)&quot;</span><br></pre></td></tr></table></figure><p>更改编辑<code>base_site.html</code>文件，用你喜欢的站点名字替换掉<code>&#123;&#123; site_header|default:_(’Django administration’) &#125;&#125;</code>（包括两个大括号一起替换掉），代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends <span class="string">&quot;admin/base.html&quot;</span> %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block title %&#125;&#123;% <span class="keyword">if</span> subtitle %&#125;&#123;&#123; subtitle &#125;&#125; | &#123;% endif %&#125;&#123;&#123; title &#125;&#125; | &#123;&#123; site_title|default:_(<span class="string">&#x27;Django site admin&#x27;</span>) &#125;&#125;&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block branding %&#125;</span><br><span class="line">&lt;h1 id=&quot;site-name&quot;&gt;&lt;a href=&quot;&#123;% url &#x27;admin:index&#x27; %&#125;&quot;&gt;投票后台管理&lt;/a&gt;&lt;/h1&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">&#123;% block nav-<span class="keyword">global</span> %&#125;&#123;% endblock %&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在这里，我们使用的是硬编码，强行改名为”投票后台管理”。但是在实际的项目中，你可以使用<code>django.contrib.admin.AdminSite.site_header</code>属性，方便的对这个页面title进行自定义。</p><p>具体操作如下，恢复<code>base_site.html</code>文件，不需要替换掉<code>&#123;&#123; site_header|default:_(’Django administration’) &#125;&#125;</code>，只需要在<code>polls/admin.py</code>中添加以下代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin.AdminSite.site_header = <span class="string">&#x27;投票后台管理&#x27;</span></span><br></pre></td></tr></table></figure><p>admin全部具体代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question, Choice</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Register your models here.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChoiceInline</span>(<span class="params">admin.TabularInline</span>):</span></span><br><span class="line">    model = Choice</span><br><span class="line">    extra = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QuestionAdmin</span>(<span class="params">admin.ModelAdmin</span>):</span></span><br><span class="line">    fieldsets = [</span><br><span class="line">        (<span class="literal">None</span>, &#123;<span class="string">&#x27;fields&#x27;</span>: [<span class="string">&#x27;question_text&#x27;</span>]&#125;),</span><br><span class="line">        (<span class="string">&#x27;Date information&#x27;</span>, &#123;<span class="string">&#x27;fields&#x27;</span>: [<span class="string">&#x27;pub_date&#x27;</span>]&#125;),</span><br><span class="line">    ]</span><br><span class="line">    inlines = [ChoiceInline]</span><br><span class="line">    list_display = (<span class="string">&#x27;question_text&#x27;</span>, <span class="string">&#x27;pub_date&#x27;</span>, <span class="string">&#x27;was_published_recently&#x27;</span>)</span><br><span class="line">    list_filter = [<span class="string">&#x27;pub_date&#x27;</span>]</span><br><span class="line">    search_fields = [<span class="string">&#x27;question_text&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将app模型加入admin站点管理</span></span><br><span class="line">admin.site.register(Question, QuestionAdmin)</span><br><span class="line">admin.AdminSite.site_header = <span class="string">&#x27;投票后台管理&#x27;</span></span><br></pre></td></tr></table></figure><p>刷新页面查看，会发现效果跟上面硬编码同样。</p><p><img src="https://typora101.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211016101445897.png" alt="image-20211016101445897"></p><blockquote><p><strong>提示</strong>：</p><ul><li><p>所有Django默认的admin模板都可以被重写，类似刚才重写<code>base_site.html</code>模板的方法一样，从源代码目录将HTML文件拷贝至你自定义的目录内，然后修改文件，或者一些修改可使用修改属性方法。</p></li><li><p>直接修改Django源码不是好的做法，所以我们不直接修改<code>base_site.html</code>模板，我们复制了一份模板，在其中修改了站点名字，为了让修改的模板能够自动替换原来的模板，我们创建了一个templates目录。</p></li><li><p>这个新建的template目录之所以能起作用，是因为我们在settings中配置了一个DIRS。</p></li></ul></blockquote><h2 id="十三、定制admin首页"><a href="#十三、定制admin首页" class="headerlink" title="十三、定制admin首页"></a>十三、定制admin首页</h2><p>默认情况下admin页面显示所有INSTALLED_APPS内并在admin应用中注册过的app，以字母顺序进行排序。</p><p>要定制admin首页，你需要重写<code>admin/index.html</code>模板，就像前面修改<code>base_site.html</code>模板的方法一样，从源码目录拷贝到你指定的目录内。编辑该文件，你会看到文件内使用了一个<code>app_list</code>模板变量。该变量包含了所有已经安装的Django应用。你可以硬编码链接到指定对象的admin页面，使用任何你认为好的方法，用于替代这个<code>app_list</code>。</p><h2 id="十四、总结"><a href="#十四、总结" class="headerlink" title="十四、总结"></a>十四、总结</h2><p>进行到这里，整个基本的投票Web应用就创建完成了，内部详细的细节可以自行学习完善，例如前端页面美观等，整个投票项目mysite，在Pycharm中的文件组织结构如下图所示，可以对比一下是否有不同。</p><p><img src="https://typora101.oss-cn-shenzhen.aliyuncs.com/typora/img/image-20211016103521291.png" alt="image-20211016103521291"></p><p>接下来可以继续深入学习，做出更高级的应用。</p></article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>Django开发投票应用</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://www.orangecola.cn/posts/23407/">https://www.orangecola.cn/posts/23407/</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>作者</h><div class="post-copyright-cc-info"><h>Orange cola</h></div></div><div class="post-copyright-c"><h>发布于</h><div class="post-copyright-cc-info"><h>2021-10-16</h></div></div><div class="post-copyright-u"><h>更新于</h><div class="post-copyright-cc-info"><h>2021-10-26</h></div></div><div class="post-copyright-c"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener external nofollow noreferrer" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener external nofollow noreferrer" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Django/">Django</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/Orangecolaa/PicX_Posts_Image@main/Blog_Image/Django02.1or73c29oyhs.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/posts/98f3a6d9/"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/Orangecolaa/PicX_Posts_Image@main/Blog_Image/HTML5.2xfb783jlm60.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">HTML5</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i> <span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/6fd05540/" title="Django初步"><img class="cover" src="https://cdn.jsdelivr.net/gh/Orangecolaa/PicX_Posts_Image@main/Blog_Image/Django.bse93qmqx1c.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-01</div><div class="title">Django初步</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/images/logo/DREAM744x744.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"><div class="author-info__name">Orange cola</div><div class="author-info__description">一个浪漫的悲观主义者</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">13</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">12</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Orangecolaa"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Orangecolaa" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:1316863816@qq.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/images/weixin/mmqrcode1626149312852.png" target="_blank" title="WeChat"><i class="fab fa-weixin"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">欢迎光临我的个人网站。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AADjango%E5%BA%94%E7%94%A8"><span class="toc-text">第一个Django应用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%96%B0%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-text">一、新建项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%88%9B%E5%BB%BA%E6%8A%95%E7%A5%A8%E5%BA%94%E7%94%A8-app"><span class="toc-text">二、创建投票应用(app)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E7%BC%96%E5%86%99%E7%AC%AC%E4%B8%80%E4%B8%AA%E8%A7%86%E5%9B%BE"><span class="toc-text">三、编写第一个视图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81settings%E5%92%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE"><span class="toc-text">四、settings和数据库配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%88%9B%E5%BB%BA%E6%A8%A1%E5%9E%8B"><span class="toc-text">五、创建模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E7%94%A8%E6%A8%A1%E5%9E%8B"><span class="toc-text">启用模型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E4%BD%93%E9%AA%8C%E6%A8%A1%E5%9E%8B%E8%87%AA%E5%B8%A6%E7%9A%84API"><span class="toc-text">六、体验模型自带的API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81admin%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%AB%99%E7%82%B9"><span class="toc-text">七、admin后台管理站点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E8%A7%86%E5%9B%BE%E5%92%8C%E6%A8%A1%E6%9D%BF"><span class="toc-text">八、视图和模板</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E4%BD%BF%E7%94%A8%E9%80%9A%E7%94%A8%E8%A7%86%E5%9B%BE"><span class="toc-text">九、使用通用视图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BF%AE%E6%94%B9URLconf"><span class="toc-text">1. 修改URLconf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BF%AE%E6%94%B9%E8%A7%86%E5%9B%BE"><span class="toc-text">2. 修改视图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E6%B5%8B%E8%AF%95"><span class="toc-text">十、测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95"><span class="toc-text">1. 自动化测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E7%A8%8B%E5%BA%8F"><span class="toc-text">2. 编写测试程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%95%E7%A8%8B%E5%BA%8F"><span class="toc-text">3. 运行测试程序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%BF%AE%E5%A4%8Dbug"><span class="toc-text">4. 修复bug</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E6%9B%B4%E5%8A%A0%E5%85%A8%E9%9D%A2%E7%9A%84%E6%B5%8B%E8%AF%95"><span class="toc-text">5. 更加全面的测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%E3%80%81%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6"><span class="toc-text">十一、静态文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%BD%BF%E7%94%A8%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6"><span class="toc-text">1. 使用静态文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%B7%BB%E5%8A%A0%E8%83%8C%E6%99%AF%E5%9B%BE%E7%89%87"><span class="toc-text">2. 添加背景图片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%9B%B4%E6%8E%A5%E8%AE%BF%E9%97%AE%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6"><span class="toc-text">3. 直接访问静态文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89Admin"><span class="toc-text">十二、自定义Admin</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%90%8E%E5%8F%B0%E8%A1%A8%E5%8D%95"><span class="toc-text">1. 自定义后台表单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%B7%BB%E5%8A%A0%E5%85%B3%E8%81%94%E5%AF%B9%E8%B1%A1"><span class="toc-text">2. 添加关联对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%AE%9A%E5%88%B6%E5%AE%9E%E4%BE%8B%E7%9A%84%E5%88%97%E8%A1%A8%E9%A1%B5%E9%9D%A2"><span class="toc-text">3. 定制实例的列表页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%AE%9A%E5%88%B6Admin%E6%95%B4%E4%BD%93%E7%95%8C%E9%9D%A2"><span class="toc-text">4. 定制Admin整体界面</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%89%E3%80%81%E5%AE%9A%E5%88%B6admin%E9%A6%96%E9%A1%B5"><span class="toc-text">十三、定制admin首页</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E5%9B%9B%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-text">十四、总结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/23407/" title="Django开发投票应用"><img src="https://cdn.jsdelivr.net/gh/Orangecolaa/PicX_Posts_Image@main/Blog_Image/Django02.1or73c29oyhs.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Django开发投票应用"></a><div class="content"><a class="title" href="/posts/23407/" title="Django开发投票应用">Django开发投票应用</a><time datetime="2021-10-16T11:20:00.000Z" title="发表于 2021-10-16 11:20:00">2021-10-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/98f3a6d9/" title="HTML5"><img src="https://cdn.jsdelivr.net/gh/Orangecolaa/PicX_Posts_Image@main/Blog_Image/HTML5.2xfb783jlm60.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="HTML5"></a><div class="content"><a class="title" href="/posts/98f3a6d9/" title="HTML5">HTML5</a><time datetime="2021-10-11T17:00:00.000Z" title="发表于 2021-10-11 17:00:00">2021-10-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/ad99f8c1/" title="如何将Python程序打包"><img src="https://cdn.jsdelivr.net/gh/Orangecolaa/PicX_Posts_Image@main/Blog_Image/python.4o5kzn797gc0.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="如何将Python程序打包"></a><div class="content"><a class="title" href="/posts/ad99f8c1/" title="如何将Python程序打包">如何将Python程序打包</a><time datetime="2021-10-03T14:00:00.000Z" title="发表于 2021-10-03 14:00:00">2021-10-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a250e24a/" title="Hadoop基础模式搭建"><img src="https://cdn.jsdelivr.net/gh/Orangecolaa/PicX_Posts_Image@main/Blog_Image/hadoop.c5l8sfa6d1s.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Hadoop基础模式搭建"></a><div class="content"><a class="title" href="/posts/a250e24a/" title="Hadoop基础模式搭建">Hadoop基础模式搭建</a><time datetime="2021-10-02T16:00:00.000Z" title="发表于 2021-10-02 16:00:00">2021-10-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/aedc73f1/" title="深入理解TCP三次握手和四次挥手"><img src="https://cdn.jsdelivr.net/gh/Orangecolaa/PicX_Posts_Image@main/Blog_Image/tcp.7jo1v3092s40.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="深入理解TCP三次握手和四次挥手"></a><div class="content"><a class="title" href="/posts/aedc73f1/" title="深入理解TCP三次握手和四次挥手">深入理解TCP三次握手和四次挥手</a><time datetime="2021-10-02T16:00:00.000Z" title="发表于 2021-10-02 16:00:00">2021-10-02</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(https://cdn.jsdelivr.net/gh/Orangecolaa/PicX_Posts_Image@main/Blog_Image/Django02.1or73c29oyhs.png)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Orange cola</div><div class="framework-info"><span>框架</span> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题</span> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a target="_blank" rel="noopener external nofollow noreferrer" href="https://o.orangecola.cn/">blog</a>!</div></div><div class="container" id="jsi-flying-fish-container"><script src="js/fish.js"></script></div><style>@media only screen and (max-width:767px){#sidebar_search_box input[type=text]{width:calc(100% - 24px)}}</style></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div></div><hr><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script defer src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script defer src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script defer src="/js/search/local-search.js"></script><script>var preloader={endLoading:()=>{document.body.style.overflow="auto",document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.body.style.overflow="",document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",preloader.endLoading())</script><div class="js-pjax"><script>document.getElementsByClassName("mermaid").length&&(window.mermaidJsLoad?mermaid.init():getScript("https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js").then(()=>{window.mermaidJsLoad=!0,mermaid.initialize({theme:"default"}),mermaid.init()}))</script><script>(()=>{const t=document.getElementById("twikoo-count"),o=()=>{twikoo.init(Object.assign({el:"#twikoo-wrap",envId:"https://mytwikoo-orangecolaa.vercel.app/",region:""},null))},e=()=>{twikoo.getCommentsCount({envId:"https://mytwikoo-orangecolaa.vercel.app/",region:"",urls:[window.location.pathname],includeReply:!1}).then((function(o){t.innerText=o[0].count})).catch((function(t){console.error(t)}))},n=(n=!1)=>{"object"==typeof twikoo?(o(),n&&t&&setTimeout(e,0)):getScript("https://cdn.jsdelivr.net/npm/twikoo@1.4.0/dist/twikoo.all.min.js").then(()=>{o(),n&&t&&setTimeout(e,0)})};btf.loadComment(document.getElementById("twikoo-wrap"),n)})()</script></div><script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/xiabo2/CDN@latest/fish.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zindex="-1" mobile="true" data-click="true"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!1,POWERMODE.mobile=!1,document.body.addEventListener("input",POWERMODE)</script><script src="https://cdn.jsdelivr.net/"></script><script>let pjaxSelectors=["title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!1,scrollRestoration:!1});document.addEventListener("pjax:send",(function(){if(window.removeEventListener("scroll",window.tocScrollFn),"object"==typeof preloader&&preloader.initLoading(),window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();const e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode")})),document.addEventListener("pjax:complete",(function(){window.refreshFn(),document.querySelectorAll("script[data-pjax], .pjax-reload script").forEach(e=>{const t=document.createElement("script"),o=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach(e=>t.setAttribute(e.name,e.value)),t.appendChild(document.createTextNode(o)),e.parentNode.replaceChild(t,e)}),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof chatBtnFn&&chatBtnFn(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll(),"object"==typeof preloader&&preloader.endLoading()})),document.addEventListener("pjax:error",e=>{404===e.request.status&&pjax.loadUrl("/404.html")})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="pjax-reload"><script async>for(var arr=document.getElementsByClassName("recent-post-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__fadeInLef"),arr[i].setAttribute("data-wow-duration","600ms"),arr[i].setAttribute("data-wow-delay","200ms"),arr[i].setAttribute("data-wow-offset","100"),arr[i].setAttribute("data-wow-iteration","1")</script><script async>for(var arr=document.getElementsByClassName("card-widget"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__fadeInRightBig"),arr[i].setAttribute("data-wow-duration",""),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script></div><script defer src="https://cdn.jsdelivr.net/gh/graingert/wow@1.3.0/dist/wow.min.js"></script><script defer src="/js/wow_init.js"></script><script src="https://cdn.jsdelivr.net/"></script><script>let pjaxSelectors=["title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"]):not([href="/music/"]):not([href="/no-pjax/"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!1,scrollRestoration:!1});document.addEventListener("pjax:send",(function(){if(window.removeEventListener("scroll",window.tocScrollFn),"object"==typeof preloader&&preloader.initLoading(),window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();const e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode")})),document.addEventListener("pjax:complete",(function(){window.refreshFn(),document.querySelectorAll("script[data-pjax], .pjax-reload script").forEach(e=>{const t=document.createElement("script"),o=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach(e=>t.setAttribute(e.name,e.value)),t.appendChild(document.createTextNode(o)),e.parentNode.replaceChild(t,e)}),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof chatBtnFn&&chatBtnFn(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll(),"object"==typeof preloader&&preloader.endLoading()})),document.addEventListener("pjax:error",e=>{404===e.request.status&&pjax.loadUrl("/404.html")})</script><div class="app-refresh" id="app-refresh" style="position:fixed;top:-2.2rem;left:0;right:0;z-index:99999;padding:0 1rem;font-size:15px;height:2.2rem;transition:all .3s ease"><div class="app-refresh-wrap" style="display:flex;color:#fff;height:100%;align-items:center;justify-content:center"><label>网站上新了 👉</label><a href="javascript:void(0)" rel="external nofollow noreferrer" onclick="location.reload()"><span style="color:#fff;text-decoration:underline;cursor:pointer">查看更新</span></a></div></div><script>function showNotification(){if(GLOBAL_CONFIG.Snackbar){var t="light"===document.documentElement.getAttribute("data-theme")?GLOBAL_CONFIG.Snackbar.bgLight:GLOBAL_CONFIG.Snackbar.bgDark,e=GLOBAL_CONFIG.Snackbar.position;Snackbar.show({text:"网站上新了 👉",backgroundColor:t,duration:5e5,pos:e,actionText:"查看更新",actionTextColor:"#fff",onActionClick:function(t){location.reload()}})}else{var o=`top: 0; background: ${"light"===document.documentElement.getAttribute("data-theme")?"#49b1f5":"#1f1f1f"};`;document.getElementById("app-refresh").style.cssText=o}}"serviceWorker"in navigator&&(navigator.serviceWorker.controller&&navigator.serviceWorker.addEventListener("controllerchange",(function(){showNotification()})),window.addEventListener("load",(function(){navigator.serviceWorker.register("/sw.js")})))</script></div><div class="js-pjax"><script async>for(var arr=document.getElementsByClassName("recent-post-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__fadeInLef"),arr[i].setAttribute("data-wow-duration","600ms"),arr[i].setAttribute("data-wow-delay","200ms"),arr[i].setAttribute("data-wow-offset","100"),arr[i].setAttribute("data-wow-iteration","1")</script><script async>for(var arr=document.getElementsByClassName("card-widget"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__fadeInRightBig"),arr[i].setAttribute("data-wow-duration",""),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script></div><script defer src="https://cdn.jsdelivr.net/gh/graingert/wow@1.3.0/dist/wow.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/hexo-butterfly-wowjs/lib/wow_init.min.js"></script></body></html>